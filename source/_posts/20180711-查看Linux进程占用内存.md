---
title: 查看Linux进程占用内存
date: 2018-07-11 11:04:27
tags:
  - 技术沉淀
  - Linux
---


>用了这么久 Linux，当有人问起一些基础的指令问题的时候，还是会愣一下。回头想想，现在老了，记性不好了，对于不常用的东西，还是找个地方把他存盘好一点。

### 方便快捷 - PS

查看内存使用，我们可能第一时间想到的是用 top，但是像我这种半吊子来说，top 在我脑海中始终是那个充满着一堆动态变化数据的表格。那些在界面中的各种复杂骚操作早已忘得一干二净。回过头来，其实 Linux 中最常用的指令 `ps`，就能够满足需求。

话不多说，先上指令:

  `ps -eo rss,pmem,pcpu,vsize,args`

上面的指令就是对进程信息进行格式化输出，`-o`参数，加上后面的字段，指定了我们希望输出的信息。

  ```
  rss: resident set size 的缩写，表示进程占用的内存大小，以 KB 为单位
  pmem: percentage of memory，表示内存占用百分比
  pcpu: percentage of cpu usage，表示 cpu 占用百分比
  vsize: 表示进程占用虚拟内存大小，以 KB 为单位
  args: 进程名，或者指令的名称
  ```

上面这几个参数是我们最经常用到的，那么如果我们要使用其中某个数值字段进行排序，我们会用到`sort`指令

  `ps -eo rss,pmem,pcpu,vsize,args | sort -k 1 -r -n | less`

上面`-k`参数表示的是我需要按照管道传入数据的第几列数据进行排序，另外两个参数不累述。

### 清晰详细 - TOP

top 的话本人用的比较少，下面简单的总结记录一下。

使用 top 查看进程的内存占用等信息，首先我们可以用 ps 指令找出进程的 pid

  `ps aux | awk '/<process_name>/'`

> 这里值得注意的是，其实 `ps aux` 输出的第 3、4 列，就已经分别表示了进程的 CPU 以及内存的占用率(百分比)，第 5、6 列，则是 VSZ、RSS，即虚拟内存占用大小（virtual memory size，和实际内存占用大小（resident set size）

然后使用如下指令

  `top -p <pid>`

> PS: 进入到 top 的交互界面时，按 `c` 键的话，可以看到完整的 command，此时如果再按 `shift + w` 的话，就能记住此配置，以便下次打开时直接显示完整的 command。

### 更进一步

其实很多情况下，无论在服务器排查故障或者调查应用的性能问题时，不仅仅需要到进程的层面，而需要更深入的查看线程的资源使用情况。

那么我们如何查看线程的资源占用情况呢。

对于 top，我们可以在参数后加上 `-H`，即

  `top -Hp <pid>`

同样，对于 ps 指令，同样可以加上 `H` 参数

  `ps H -eo rss,pmem,pcpu,vsize,args  | sort -k 1 -r -n`

如果希望查看一个进程树的情况，我们在知道进程名称的情况下，可以使用如下指令查看

  `ps -ef f | grep <process_name>`

但是有些情况下上述指令是不准的，因为线程并没包括所属进程的名称，那么我们就可以使用下面的指令

  ```
  ps -Lf <pid>

  -L: Show threads, possibly with LWP and NLWP columns.
  ```

以上就是 Linux 使用时查看进程、线程信息的一些基本指令介绍了，更多的会在以后的使用过程中再进行补充。
